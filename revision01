var DT_CHEST_BATTLE = "dropTable_battleChest"; // 전투 보상 상자의 드롭테이블
var IC_CHEST_BATTLE = "battleChest"; // 전투 보상 상자의 ItemClass

handlers.unlockChest = function (args, context) {
    //보상 상자 남은 시간 체크
    
    //상자 열기
    var request = {
        PlayFabId: currentPlayerId,
        ContainerItemInstanceId: 
    };
    
    var playerStatResult = server.UpdatePlayerStatistics(request);  

    return playerStatResult;

};


handlers.grantChest = function (args, context) {

    try {
        //인벤토리 체크
        var GetUserInventoryRequest = {
            "PlayFabId": currentPlayerId
        };  
        var GetUserInventoryResult = server.GetUserInventory(GetUserInventoryRequest);
        for(var index in GetUserInventoryResult.Inventory)
        {
            if(GetUserInventoryResult.Inventory[index].ItemClass === IC_CHEST_BATTLE)
            {
                throw "You are only allowed one Referral Badge.";
            }
        }        

        var DTresult = server.EvaluateRandomResultTable({ TableId : DT_CHEST_BATTLE });

        var pull = server.GrantItemsToUser({ PlayFabId: currentPlayerId, ItemIds: [DTresult.ResultItemId] });

        var results = pull.ItemGrantResults;

        var instId = results.ItemInstanceId;

    

        return { "InstanceId": instId };
    } catch(e) {
        var retObj = {};
        retObj["errorDetails"] = "Error: " + e;
        return retObj;
    }
    

}

handlers.userUpdate = function (args, context) {

    server.UpdateUserInventoryItemCustomData({ 

      PlayFabId: currentPlayerId, 

      ItemInstanceId: instId 

      Data: { Time: position }

    });

}

